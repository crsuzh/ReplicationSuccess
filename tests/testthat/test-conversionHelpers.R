test_that("Output of function 'ci2se' stays the same.", {
    # set the length of the sequences
    l <- 5L
    # set lower and upper bounds for ratio = TRUE
    lower_ratio <- seq(1e-5, 10, length.out = l)
    upper_ratio <- lower_ratio + seq(0, 10, length.out = l)
    # set lower and upper bounds for ratio = FALSE
    lower_nonratio <- seq(-10, 10, length.out = l)
    upper_nonratio <- lower_nonratio + seq(0, 10, length.out = l)
    # set conf.level
    conf.level <- seq(1e-6, 1 - 1e-6, length.out = l)
    # construct a parameter grid
    grid <- rbind(
        expand.grid(
            lower = lower_ratio,
            upper = upper_ratio,
            conf.level = conf.level,
            ratio = TRUE,
            stringsAsFactors = FALSE
        ),
        expand.grid(
            lower = lower_nonratio,
            upper = upper_nonratio,
            conf.level = conf.level,
            ratio = FALSE,
            stringsAsFactors = FALSE
        )
    )
    grid <- grid[with(grid, lower <= upper), ]
    # iterate over the grid
    out <- lapply(
        seq_len(nrow(grid)),
        function(i) {
            ci2se(
                lower = grid[i, "lower"],
                upper = grid[i, "upper"],
                conf.level = grid[i, "conf.level"],
                ratio = grid[i, "ratio"]
            )
        }
    )
    res <- list(
        0, 5235066.16771778, 276525.11841561, 0.199470890839573, 
        5511591.48560359, 553050.436301412, 276525.517356693, 114768.608488804, 
        0.199471090239863, 5673348.5274521, 714807.478149928, 438282.559205209, 
        276525.65033732, 161757.241319607, 5788117.00296018, 829575.953658005, 
        553051.034713286, 391294.125845397, 276525.716827684, 0, 
        20.5912062510812, 1.08766261294129, 7.84583446087584e-07, 
        21.6788696486032, 2.17532601046328, 1.08766418210544, 0.451422009355957, 
        7.84584230393336e-07, 22.3151123444084, 2.81156870626852, 
        1.72390687791068, 1.0876647051612, 0.636243480389471, 22.7665338307082, 
        3.26299019256832, 2.17532836421048, 1.539086191461, 1.08766496668927, 
        0, 9.72762363963899, 0.513829661875377, 3.70650091323827e-07, 
        10.2414536721632, 1.02765969439955, 0.513830403174262, 0.213259162970783, 
        3.70650461842731e-07, 10.5420251594668, 1.32823118170315, 
        0.814401890477864, 0.513830650274385, 0.300571857954064, 
        10.7552840753372, 1.54149009757362, 1.02766080634834, 0.72708956614486, 
        0.513830773824539, 0, 5.70364923687938, 0.301276474852418, 
        2.17325236752979e-07, 6.00492592905627, 0.602553167029312, 
        0.301276909502131, 0.125041377750197, 2.17325454001296e-07, 
        6.18116160569173, 0.778788843664773, 0.477512586137592, 0.301277054385658, 
        0.176235893960915, 6.30620283855829, 0.903830076531334, 0.602553819004153, 
        0.426318287252219, 0.301277126827476, 0, 1.3413056732083, 
        0.0708500519826567, 5.11075560368074e-08, 1.41215577629833, 
        0.141700155072691, 0.07085015419759, 0.0294055090691173, 
        5.11076071262745e-08, 1.45360045549851, 0.183144834272876, 
        0.112294833397775, 0.0708501882693025, 0.0414447303077923, 
        1.48300593049589, 0.212550309270255, 0.141700308395154, 0.100255663266682, 
        0.0708502053051715, 0, 2992067.10259174, 997355.700863912, 
        5984134.20518347, 3989422.80345565, 1994711.40172782, 0, 
        8976201.30777521, 6981489.90604739, 4986778.50431956, 2992067.10259174, 
        997355.700863912, 11968268.4103669, 9973557.00863912, 7978845.6069113, 
        5984134.20518347, 3989422.80345565, 0, 11.7687664019346, 
        3.92292213397819, 23.5375328038691, 15.6916885359128, 7.84584426795638, 
        0, 35.3062992058037, 27.4604549378473, 19.6146106698909, 
        11.7687664019346, 3.92292213397819, 47.0750656077383, 39.2292213397819, 
        31.3833770718255, 23.5375328038691, 15.6916885359128, 0, 
        5.55975831939601, 1.853252773132, 11.119516638792, 7.41301109252801, 
        3.70650554626401, 0, 16.679274958188, 12.972769411924, 9.26626386566001, 
        5.55975831939601, 1.853252773132, 22.239033277584, 18.53252773132, 
        14.826022185056, 11.119516638792, 7.41301109252801, 0, 3.25988262605456, 
        1.08662754201819, 6.51976525210913, 4.34651016807275, 2.17325508403638, 
        0, 9.77964787816369, 7.60639279412732, 5.43313771009094, 
        3.25988262605456, 1.08662754201819, 13.0395305042183, 10.8662754201819, 
        8.6930203361455, 6.51976525210913, 4.34651016807275, 0, 0.766614298798019, 
        0.25553809959934, 1.53322859759604, 1.02215239839736, 0.51107619919868, 
        0, 2.29984289639406, 1.78876669719538, 1.2776904979967, 0.766614298798019, 
        0.25553809959934, 3.06645719519208, 2.5553809959934, 2.04430479679472, 
        1.53322859759604, 1.02215239839736
    )
    expect_equal(out, res)
})

test_that("Output of function 'ci2estimate' stays the same.", {
    # set the length of the sequences
    l <- 5L
    # set lower and upper bounds for ratio = TRUE
    lower_ratio <- seq(1e-5, 10, length.out = l)
    upper_ratio <- lower_ratio + seq(0, 10, length.out = l)
    #upper_ratio <- lower_ratio + seq(1e-2, 10, length.out = l)
    # set lower and upper bounds for ratio = FALSE
    lower_nonratio <- seq(-10, 10, length.out = l)
    upper_nonratio <- lower_nonratio + seq(0, 10, length.out = l)
    # upper_nonratio <- lower_nonratio + seq(1e-2, 10, length.out = l)
    # set conf.level
    conf.level <- seq(1e-6, 1 - 1e-6, length.out = l)
    # construct a parameter grid
    grid <- rbind(
        expand.grid(
            lower = lower_ratio,
            upper = upper_ratio,
            ratio = TRUE,
            antilog = c(TRUE, FALSE),
            stringsAsFactors = FALSE
        ),
        expand.grid(
            lower = lower_nonratio,
            upper = upper_nonratio,
            ratio = FALSE,
            antilog = FALSE,
            stringsAsFactors = FALSE
        )
    )
    grid <- grid[with(grid, lower <= upper), ]
    # iterate over the grid
    out <- lapply(
        seq_len(nrow(grid)),
        function(i) {
            ci2estimate(
                lower = grid[i, "lower"],
                upper = grid[i, "upper"],
                ratio = grid[i, "ratio"],
                antilog = grid[i, "antilog"]
            )
        }
    )
    res <- list(
        1e-05, 0.00707107311516434, 3.53554186088303, 5.00000624999984, 
        0.0100000024999997, 5.00000874999609, 7.07107311516611, 8.66025764628354, 
        10.0000024999997, 0.0122474497345366, 6.1237340528487, 8.66025908965849, 
        10.6066043694486, 12.2474497345366, 0.0141421356237309, 7.07107841845924, 
        10.0000049999987, 12.2474507551572, 14.142135623731, -11.5129254649702, 
        -4.95174302626863, 1.26286657215132, 1.60943916243329, -4.60516993598815, 
        1.60943966243179, 1.95601225271376, 2.15874447343473, 2.30258534299398, 
        -4.40243754860068, 1.81217204981926, 2.15874464010123, 2.3614768608222, 
        2.50531773038145, -4.25859659570812, 1.95601300271182, 2.3025855929938, 
        2.50531781371477, 2.64915868327402, -10, -6.25, -3.75, -2.5, 
        0, 2.5, 5, 1.25, 3.75, 6.25, 8.75, 11.25, 5, 7.5, 10, 12.5, 
        15
    )
    expect_equal(out, res)
})

test_that("Output of function 'ci2z' stays the same.", {
    # set the length of the sequences
    l <- 5L
    # set lower and upper bounds for ratio = TRUE
    lower_ratio <- seq(1e-5, 10, length.out = l)
    upper_ratio <- lower_ratio + seq(0, 10, length.out = l)
    # set lower and upper bounds for ratio = FALSE
    lower_nonratio <- seq(-10, 10, length.out = l)
    upper_nonratio <- lower_nonratio + seq(0, 10, length.out = l)
    # set conf.level
    conf.level <- seq(1e-6, 1 - 1e-6, length.out = l)
    # construct a parameter grid
    grid <- rbind(
        expand.grid(
            lower = lower_ratio,
            upper = upper_ratio,
            conf.level = conf.level,
            ratio = TRUE,
            stringsAsFactors = FALSE
        ),
        expand.grid(
            lower = lower_nonratio,
            upper = upper_nonratio,
            conf.level = conf.level,
            ratio = FALSE,
            stringsAsFactors = FALSE
        )
    )
    grid <- grid[with(grid, lower <= upper), ]
    # iterate over the grid
    out <- lapply(
        seq_len(nrow(grid)),
        function(i) {
            ci2z(
                lower = grid[i, "lower"],
                upper = grid[i, "upper"],
                conf.level = grid[i, "conf.level"],
                ratio = grid[i, "ratio"]
            )
        }
    )
    res <-list(-Inf, -9.45879740127015e-07, 4.56691449726915e-06, 8.06854150828305, 
        -8.35542682729112e-07, 2.91011371981749e-06, 7.07353256730618e-06, 
        1.88095377460756e-05, 11.5434539422487, -7.75985738809848e-07, 
        2.53518899174018e-06, 4.9254632536963e-06, 8.53981125418763e-06, 
        1.54881333901544e-05, -7.35748187801002e-07, 2.35784679399976e-06, 
        4.16342335239913e-06, 6.4026461125681e-06, 9.58015302759286e-06, 
        -Inf, -0.240478530781004, 1.16108300232572, 2051329.49268678, 
        -0.212426662950338, 0.73986136086748, 1.79836045435221, 4.78209841056401, 
        2934784.12361108, -0.197285027323818, 0.644541264732012, 
        1.25223970491815, 2.17114414912656, 3.93767135947365, -0.187055114642177, 
        0.599454147047936, 1.05850023880395, 1.62779565408001, 2.43563851407088, 
        -Inf, -0.509039330642977, 2.45775334873059, 4342206.30213514, 
        -0.449659792779736, 1.56612122787609, 3.80672735717896, 10.1226340916028, 
        6212282.40630382, -0.417608332555276, 1.3643498773275, 2.65071172518344, 
        4.59582716515875, 8.3351706558115, -0.395953892605537, 1.26891052092432, 
        2.2406085536878, 3.44567977642472, 5.15570265197593, -Inf, 
        -0.868171028865348, 4.19171982402522, 7405670.81154337, -0.766898707893287, 
        2.67103344650331, 6.49240678930931, 17.264240943885, 10595101.9569951, 
        -0.71223466225941, 2.32691064408635, 4.5208120220714, 7.83822341079891, 
        14.2157064266208, -0.675302825603641, 2.16413798732887, 3.8213774776157, 
        5.87663698374864, 8.79309594847218, -Inf, -3.69173345433219, 
        17.8244974677005, 31491217.4879616, -3.26109202205697, 11.3580656394212, 
        27.6077345895218, 73.412926413232, 45053671.5073522, -3.02864348449235, 
        9.89474836685386, 19.2238999318378, 33.330565782637, 60.4496087144379, 
        -2.87159781908904, 9.20258836332615, 16.2496865325985, 24.989289702773, 
        37.3909810403986, -Inf, -2.08885689581836e-06, -3.75994241247304e-06, 
        -4.17771379163671e-07, 0, 1.25331413749101e-06, Inf, 1.3925712638789e-07, 
        5.37134630353292e-07, 1.25331413749101e-06, 2.9243996541457e-06, 
        1.12798272374191e-05, 4.17771379163671e-07, 7.51988482494608e-07, 
        1.25331413749101e-06, 2.08885689581836e-06, 3.75994241247304e-06, 
        -Inf, -0.531066705425695, -0.955920069766251, -0.106213341085139, 
        0, 0.318640023255417, Inf, 0.0354044470283797, 0.136560009966607, 
        0.318640023255417, 0.743493387595973, 2.86776020929875, 0.106213341085139, 
        0.19118401395325, 0.318640023255417, 0.531066705425695, 0.955920069766251, 
        -Inf, -1.12414958366014, -2.02346925058824, -0.224829916732027, 
        0, 0.674489750196082, Inf, 0.0749433055773424, 0.289067035798321, 
        0.674489750196082, 1.57380941712419, 6.07040775176474, 0.224829916732027, 
        0.404693850117649, 0.674489750196082, 1.12414958366014, 2.02346925058824, 
        -Inf, -1.91724694320187, -3.45104449776337, -0.383449388640374, 
        0, 1.15034816592112, Inf, 0.127816462880125, 0.493006356823338, 
        1.15034816592112, 2.68414572048262, 10.3531334932901, 0.383449388640374, 
        0.690208899552674, 1.15034816592112, 1.91724694320187, 3.45104449776337, 
        -Inf, -8.15273079278514, -14.6749154270133, -1.63054615855703, 
        0, 4.89163847567108, Inf, 0.543515386185676, 2.09641648957332, 
        4.89163847567108, 11.4138231098992, 44.0247462810398, 1.63054615855703, 
        2.93498308540265, 4.89163847567108, 8.15273079278514, 14.6749154270133
    )
    expect_equal(out, res)
})

test_that("Output of function 'ci2p' stays the same.", {
    # set the length of the sequences
    l <- 5L
    # set lower and upper bounds for ratio = TRUE
    lower_ratio <- seq(1e-5, 10, length.out = l)
    upper_ratio <- lower_ratio + seq(0, 10, length.out = l)
    # set lower and upper bounds for ratio = FALSE
    lower_nonratio <- seq(-10, 10, length.out = l)
    upper_nonratio <- lower_nonratio + seq(0, 10, length.out = l)
    # set conf.level
    conf.level <- seq(1e-6, 1 - 1e-6, length.out = l)
    # construct a parameter grid
    grid <- rbind(
        expand.grid(
            lower = lower_ratio,
            upper = upper_ratio,
            conf.level = conf.level,
            ratio = TRUE,
            alternative = c("two.sided", "one.sided", "less", "greater"),
            stringsAsFactors = FALSE
        ),
        expand.grid(
            lower = lower_nonratio,
            upper = upper_nonratio,
            conf.level = conf.level,
            ratio = FALSE,
            alternative = c("two.sided", "one.sided", "less", "greater"),
            stringsAsFactors = FALSE
        )
    )
    grid <- grid[with(grid, lower <= upper), ]
    # iterate over the grid
    out <- lapply(
        seq_len(nrow(grid)),
        function(i) {
            ci2p(
                lower = grid[i, "lower"],
                upper = grid[i, "upper"],
                conf.level = grid[i, "conf.level"],
                ratio = grid[i, "ratio"],
                alternative = grid[i, "alternative"]
            )
        }
    )
    # res <- 
    expect_equal(out, res)
})

